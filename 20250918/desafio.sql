DROP TABLE CLIENTES PURGE;
CREATE TABLE CLIENTES (
  id    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome  VARCHAR2(100) NOT NULL,
  email VARCHAR2(120) UNIQUE
);

INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('PEDRO', 'TOMATEFRITINHO@GMAIL.COM');
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('GLAUBER', "UNICORNIOCOLORIDINHO@GMAIL.COM");
INSERT INTO CLIENTES (NOME, EMAIL) VALUES ('JAMILI', 'JAMILI123@GMAIL.COM');

DROP TABLE PRODUTO PURGE;
CREATE TABLE PRODUTOS (
  id     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome   VARCHAR2(100) NOT NULL,
  preco  NUMBER(10,2)  NOT NULL CHECK (preco >= 0),
  tipo   VARCHAR2(50) NOT NULL
);
 
INSERT 
  INTO PRODUTOS (nome, preco, tipo) VALUES ('Notebook X', 3000, 'Notebook'),
                                           ('Notebook Y', 3500, 'Notebook'),
                                           ('Celular Z', 2000, 'Celular');

SELECT ID, NOME, PRECO, TIPO FROM PRODUTOS;

UPDATE PRODUTOS SET PRECO = 300 WHERE PRECO = 3000;
UPDATE PRODUTOS SET PRECO = 350 WHERE PRECO = 3500;
UPDATE PRODUTOS SET PRECO = 200 WHERE PRECO = 2000;


DROP TABLE PEDIDOS PURGE;
CREATE TABLE PEDIDOS (
  id         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  cliente_id NUMBER NOT NULL,
  produto_id NUMBER NOT NULL,
  status     VARCHAR2(20) NOT NULL CHECK (status IN ('ABERTO','FINALIZADO','CANCELADO'))
);

SELECT ID, CLIENTE_ID, PRODUTO_ID,STATUS FROM PEDIDOS

DELETE FROM PEDIDOS
WHERE STATUS = 'CANCELADO'


INSERT INTO PEDIDOS (cliente_id, produto_id, status) VALUES (1, 1, 'ABERTO');
INSERT INTO PEDIDOS (cliente_id, produto_id, status) VALUES (2, 2, 'CANCELADO');
INSERT INTO PEDIDOS (cliente_id, produto_id, status) VALUES (3, 3, 'FINALIZADO');
INSERT INTO PEDIDOS (cliente_id, produto_id, status) VALUES (1, 2, 'CANCELADO');

CREATE TABLE CLIENTES_STG(
    NOME VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(200) NOT NULL
);

INSERT INTO CLIENTES_STG (NOME, EMAIL) VALUES ('PEDRO ATUALIZADO', 'TOMATEFRITINHO@GMAIL.COM');
INSERT INTO CLIENTES_STG (NOME, EMAIL) VALUES ('CARLINHOS NOVO', 'CARLINHOSSAFADINHO@GMAIL.COM');

MERGE INTO CLIENTES c 
USING CLIENTES_STG s
    ON (c.EMAIL = s.EMAIL)
WHEN MATCHED THEN
    UPDATE SET c.NOME = s.NOME
WHEN NOT MATCHED THEN
    INSERT (NOME, EMAIL)
    VALUES (s.NOME, s.EMAIL);
